<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RoutineCoach – erschaffe dein zukünftiges Ich in kleinen Schritten</title>
  <link rel="manifest" href="manifest.json">
  <style>
    /* Basis-Styles */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f9f9f9;
      color: #333;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1, h2, p {
      text-align: center;
    }
    form {
      margin: 20px 0;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input[type="text"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      padding: 10px 20px;
      background: #007BFF;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
      transition: background 0.3s ease, transform 0.3s ease;
    }
    button:hover {
      background: #0056b3;
      transform: scale(1.02);
    }
    .section {
      margin-top: 30px;
      display: none;
    }
    .fade-in {
      animation: fadeIn 0.7s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #f0f0f0;
    }
    .success {
      color: green;
    }
    .failure {
      color: red;
    }
    .button-group {
      text-align: center;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>RoutineCoach –  erschaffe dein zukünftiges Ich in kleinen Schrittens</h1>
    <p>Erstelle drei kleine Gewohnheiten und checke sie täglich!</p>
    
    <!-- Bereich 1: Zieleingabe -->
    <div class="section fade-in" id="goalsSection">
      <h2>Wöchentliche Ziele festlegen</h2>
      <p>
        <strong>SMART-Ziele</strong> sind Ziele, die spezifisch, messbar, attraktiv, realistisch und terminiert sind.
        <br><em>S</em> – Spezifisch: Klar formuliert.
        <br><em>M</em> – Messbar: Erfolge lassen sich überprüfen.
        <br><em>A</em> – Attraktiv: Motiviert und erstrebenswert.
        <br><em>R</em> – Realistisch: Erreichbar und vernünftig.
        <br><em>T</em> – Terminiert: Mit klarem Zeitrahmen.
      </p>
      <p>Definiere bis zu drei SMART-Ziele für diese Woche:</p>
      <form id="goalsForm">
        <label for="goal1">Ziel 1</label>
        <input type="text" id="goal1" placeholder="z. B. 10 Minuten Lesen" required>
        <label for="goal2">Ziel 2</label>
        <input type="text" id="goal2" placeholder="z. B. 5 Minuten Meditieren" required>
        <label for="goal3">Ziel 3</label>
        <input type="text" id="goal3" placeholder="z. B. 1 Seite Tagebuch" required>
        <button type="submit">Ziele speichern</button>
      </form>
    </div>
    
    <!-- Bereich 2: Täglicher Check-In pro Ziel -->
    <div class="section fade-in" id="checkinSection">
      <h2>Täglicher Check-In – Tag <span id="currentDayDisplay"></span></h2>
      <form id="checkinForm">
        <div id="checkinGoalsContainer">
          <!-- Dynamisch erzeugte Felder für jedes Ziel -->
        </div>
        <button type="submit">Tagescheck speichern</button>
      </form>
      
      <table id="progressTable">
        <thead>
          <tr>
            <th>Tag</th>
            <th>Ziel 1</th>
            <th>Ziel 2</th>
            <th>Ziel 3</th>
          </tr>
        </thead>
        <tbody id="progressTableBody">
          <!-- Fortschritt wird hier angezeigt -->
        </tbody>
      </table>
    </div>
    
    <!-- Bereich 3: Wochen-Zusammenfassung -->
    <div class="section fade-in" id="summarySection">
      <h2>Woche abgeschlossen!</h2>
      <p id="summaryMessage"></p>
      <button id="restartBtn">Neue Woche starten</button>
    </div>
    
    <!-- Button für Test-Benachrichtigung -->
    <div class="button-group">
      <button id="notifyBtn">Test-Benachrichtigung</button>
      <button id="affirmationBtn">Tägliche Affirmation anzeigen</button>
    </div>
  </div>
  
  <script>
    // Tägliche Affirmationen (47 kurze Botschaften)
    const dailyAffirmations = [
      "Ich starte kraftvoll in den Tag.",
      "Ich bin fokussiert und stark.",
      "Ich vertraue meinem Weg.",
      "Ich bin voller Energie.",
      "Ich lebe meine Ziele.",
      "Ich bin dankbar.",
      "Ich strahle Positivität aus.",
      "Ich bin mutig.",
      "Ich wachse täglich.",
      "Ich bin zielstrebig.",
      "Ich glaube an mich.",
      "Ich umarme den Tag.",
      "Ich bin voller Freude.",
      "Ich bin erfolgreich.",
      "Ich bin im Einklang.",
      "Ich bin ausgeglichen.",
      "Ich bin kreativ.",
      "Ich bin resilient.",
      "Ich bin inspiriert.",
      "Ich bin bereit zu handeln.",
      "Ich schaffe Herausforderungen.",
      "Ich bin selbstbewusst.",
      "Ich genieße jeden Moment.",
      "Ich bin offen für Neues.",
      "Ich entscheide mich für Glück.",
      "Ich wachse an jeder Aufgabe.",
      "Ich lasse Zweifel los.",
      "Ich bin klar und stark.",
      "Ich vertraue meiner Intuition.",
      "Ich setze Prioritäten.",
      "Ich bleibe fokussiert.",
      "Ich genieße den Fortschritt.",
      "Ich bin voller Optimismus.",
      "Ich feiere kleine Erfolge.",
      "Ich bin voller Tatendrang.",
      "Ich lasse mich inspirieren.",
      "Ich schätze den Moment.",
      "Ich bin in Harmonie.",
      "Ich nehme Herausforderungen an.",
      "Ich erreiche meine Ziele.",
      "Ich bin voller Zuversicht.",
      "Ich bin gelassen.",
      "Ich bin voller Entschlossenheit.",
      "Ich wähle Positivität.",
      "Ich bin bereit für Erfolg.",
      "Ich lebe im Jetzt.",
      "Ich bin dankbar für den Tag."
    ];
    
    // Motivierende Nachrichten für den Check-In (können auch zufällig gewählt werden)
    const motivationalMessages = [
      "Klasse gemacht, weiter so!",
      "Super, jeder Schritt zählt!",
      "Toller Fortschritt – bleib dran!",
      "Du bist auf dem richtigen Weg!",
      "Fantastisch, deine Gewohnheiten wachsen!"
    ];
    
    // Globale Variablen und Datenstruktur für die Woche
    const goalsSection = document.getElementById('goalsSection');
    const checkinSection = document.getElementById('checkinSection');
    const summarySection = document.getElementById('summarySection');
    const goalsForm = document.getElementById('goalsForm');
    const checkinForm = document.getElementById('checkinForm');
    const checkinGoalsContainer = document.getElementById('checkinGoalsContainer');
    const progressTableBody = document.getElementById('progressTableBody');
    const currentDayDisplay = document.getElementById('currentDayDisplay');
    const summaryMessage = document.getElementById('summaryMessage');
    const restartBtn = document.getElementById('restartBtn');
    const notifyBtn = document.getElementById('notifyBtn');
    const affirmationBtn = document.getElementById('affirmationBtn');
    
    let weekData = {
      goals: [],
      currentDay: 1,
      totalDays: 6,
      results: [] // Für jeden Tag ein Array mit drei Einträgen ("JA" oder "NEIN")
    };
    
    // Initialisierung beim Laden der Seite
    window.addEventListener('load', () => {
      loadWeekData();
      if (weekData.goals.length > 0) {
        showCheckinSection();
      } else {
        goalsSection.style.display = 'block';
      }
    });
    
    // Ziele speichern
    goalsForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const g1 = document.getElementById('goal1').value.trim();
      const g2 = document.getElementById('goal2').value.trim();
      const g3 = document.getElementById('goal3').value.trim();
      if (g1 && g2 && g3) {
        weekData.goals = [g1, g2, g3];
        weekData.currentDay = 1;
        weekData.results = [];
        saveWeekData();
        goalsSection.style.display = 'none';
        showCheckinSection();
      } else {
        alert("Bitte alle drei Ziele ausfüllen.");
      }
    });
    
    // Generiere das Check-In Formular für den aktuellen Tag
    function generateCheckinForm() {
      checkinGoalsContainer.innerHTML = "";
      currentDayDisplay.textContent = weekData.currentDay;
      weekData.goals.forEach((goal, index) => {
        const div = document.createElement('div');
        div.style.marginBottom = "15px";
        div.innerHTML = `<p><strong>Ziel ${index + 1}:</strong> ${goal}</p>
          <label>
            <input type="radio" name="goal${index}" value="JA" required> JA
          </label>
          <label style="margin-left: 10px;">
            <input type="radio" name="goal${index}" value="NEIN" required> NEIN
          </label>`;
        checkinGoalsContainer.appendChild(div);
      });
    }
    
    // Verarbeite den Check-In des Tages
    checkinForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const dayResults = [];
      for (let i = 0; i < weekData.goals.length; i++) {
        const radios = document.getElementsByName(`goal${i}`);
        let selectedValue = null;
        for (const radio of radios) {
          if (radio.checked) {
            selectedValue = radio.value;
            break;
          }
        }
        if (!selectedValue) {
          alert("Bitte wähle für jedes Ziel JA oder NEIN.");
          return;
        }
        dayResults.push(selectedValue);
      }
      weekData.results.push(dayResults);
      saveWeekData();
      updateProgressTable();
      
      // Zeige eine zufällige, motivierende Nachricht für den Tag
      alert(motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)]);
      
      weekData.currentDay++;
      if (weekData.currentDay > weekData.totalDays) {
        checkinSection.style.display = 'none';
        showSummary();
      } else {
        generateCheckinForm();
      }
    });
    
    // Aktualisiere die Fortschrittstabelle
    function updateProgressTable() {
      progressTableBody.innerHTML = "";
      weekData.results.forEach((dayResults, dayIndex) => {
        const row = document.createElement('tr');
        row.innerHTML = `<td>Tag ${dayIndex + 1}</td>
                         <td>${dayResults[0]}</td>
                         <td>${dayResults[1]}</td>
                         <td>${dayResults[2]}</td>`;
        progressTableBody.appendChild(row);
      });
    }
    
    // Zeige die Wochen-Zusammenfassung
    function showSummary() {
      summarySection.style.display = 'block';
      let summaryText = "";
      weekData.goals.forEach((goal, i) => {
        let successes = weekData.results.reduce((acc, day) => acc + (day[i] === "JA" ? 1 : 0), 0);
        summaryText += `Ziel ${i + 1} ("${goal}"): ${successes} von ${weekData.totalDays} Tagen erreicht.<br>`;
      });
      summaryMessage.innerHTML = summaryText;
    }
    
    // Neue Woche starten
    restartBtn.addEventListener('click', () => {
      weekData = {
        goals: [],
        currentDay: 1,
        totalDays: 6,
        results: []
      };
      saveWeekData();
      summarySection.style.display = 'none';
      goalsSection.style.display = 'block';
    });
    
    // Check-In Bereich anzeigen
    function showCheckinSection() {
      checkinSection.style.display = 'block';
      generateCheckinForm();
      updateProgressTable();
    }
    
    // Lokale Speicherung
    function saveWeekData() {
      localStorage.setItem("tinyHabitsWeekData", JSON.stringify(weekData));
    }
    function loadWeekData() {
      const data = localStorage.getItem("tinyHabitsWeekData");
      if (data) {
        weekData = JSON.parse(data);
      }
    }
    
    // Service Worker registrieren (für PWA-Funktionalität)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
      .then(registration => {
        console.log('Service Worker registriert mit Scope:', registration.scope);
      })
      .catch(error => {
        console.log('Service Worker Registrierung fehlgeschlagen:', error);
      });
    }
    
    // Test-Benachrichtigung
    function askNotificationPermission() {
      if (!('Notification' in window)) {
        alert("Dieser Browser unterstützt keine Notifications.");
      } else {
        Notification.requestPermission().then(permission => {
          if (permission === 'granted') {
            console.log("Notification permission granted.");
          }
        });
      }
    }
    notifyBtn.addEventListener('click', () => {
      if (Notification.permission === 'granted') {
        navigator.serviceWorker.getRegistration().then(registration => {
          registration.showNotification("RoutineCoach – Tiny Habits", {
            body: "Dies ist eine Test-Benachrichtigung!",
            icon: "icon-192.png"
          });
        });
      } else {
        askNotificationPermission();
      }
    });
    
    // Tägliche Affirmation anzeigen
    affirmationBtn.addEventListener('click', () => {
      const randomIndex = Math.floor(Math.random() * dailyAffirmations.length);
      alert("Tägliche Affirmation: " + dailyAffirmations[randomIndex]);
    });
    
    // Event für Installation (PWA)
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      console.log("App kann installiert werden!");
    });
  </script>
</body>
</html>



